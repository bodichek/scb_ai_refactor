{% extends "base.html" %}
{% block content %}
<div class="container mt-4 text-center">
  <h3>ğŸ“ NahrÃ¡t vÃ­ce souborÅ¯</h3>
  <form id="uploadForm" method="post" enctype="multipart/form-data" onsubmit="startProgress()">
    {% csrf_token %}
    <div class="mb-3">
      <input type="file" name="pdf_files" id="pdf_files" class="form-control" multiple required>
    </div>
    <button type="submit" class="btn btn-primary btn-lg">ğŸš€ NahrÃ¡t a analyzovat</button>
  </form>

  <!-- ZÃ¡bavnÃ½ progressbar -->
  <div id="progressSection" class="mt-5" style="display:none;">
    <h4 id="progressText">ğŸ“¦ NahrÃ¡vÃ¡m soubory...</h4>
    <div class="progress" style="height: 25px;">
      <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated bg-success"
           role="progressbar" style="width: 0%">0%</div>
    </div>
    <div id="funText" class="mt-3 text-muted"></div>
  </div>
</div>

<script>
const funMessages = [
  "ğŸ§  OpenAI pÅ™emÃ½Å¡lÃ­, co je co...",
  "ğŸ“Š Detekujeme rok a typ vÃ½kazu...",
  "ğŸ’¼ PoÄÃ­tÃ¡me trÅ¾by a aktiva...",
  "ğŸ“ˆ SklÃ¡dÃ¡me vÃ½sledovku...",
  "âœ¨ TÃ©mÄ›Å™ hotovo â€“ finÃ¡lnÃ­ Ãºpravy!"
];

function startProgress() {
  document.getElementById("uploadForm").style.display = "none";
  document.getElementById("progressSection").style.display = "block";

  const bar = document.getElementById("progressBar");
  const text = document.getElementById("progressText");
  const funText = document.getElementById("funText");

  let width = 0;
  let step = 0;
  const timer = setInterval(() => {
    if (width >= 100) {
      clearInterval(timer);
      text.innerHTML = "âœ… ZpracovÃ¡nÃ­ dokonÄeno â€“ naÄÃ­tÃ¡m vÃ½sledky...";
    } else {
      width += Math.random() * 7;  // nÃ¡hodnÃ© zrychlenÃ­
      bar.style.width = Math.min(width, 100) + "%";
      bar.innerHTML = Math.min(Math.round(width), 100) + "%";

      // zmÄ›na zÃ¡bavnÃ½ch hlÃ¡Å¡ek
      if (step < funMessages.length && width > (step+1)*20) {
        funText.innerHTML = funMessages[step];
        step++;
      }
    }
  }, 400);
}
</script>
{% endblock %}
