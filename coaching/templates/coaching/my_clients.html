{% extends "base.html" %}
{% block content %}

<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>🎯 Moji klienti</h2>
        <div>
          <a href="{% url 'coaching:edit_coach' %}" class="btn btn-outline-primary">
            ⚙️ Upravit profil
          </a>
        </div>
      </div>

      <!-- Přehled statistik -->
      <div class="row mb-4">
        <div class="col-md-3">
          <div class="card text-center">
            <div class="card-body">
              <h3 class="text-primary">{{ clients_count }}</h3>
              <p class="text-muted">Celkem klientů</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-center">
            <div class="card-body">
              <h3 class="text-success">{{ active_clients }}</h3>
              <p class="text-muted">Aktivní klienti</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-center">
            <div class="card-body">
              <h3 class="text-info">{{ statements_total }}</h3>
              <p class="text-muted">Nahraných výkazů</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-center">
            <div class="card-body">
              <h3 class="text-warning">{{ recent_uploads }}</h3>
              <p class="text-muted">Nových tento měsíc</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Seznam klientů -->
      <div class="card">
        <div class="card-header">
          <h5>📋 Seznam klientů</h5>
        </div>
        <div class="card-body">
          {% if clients %}
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Firma</th>
                    <th>IČO</th>
                    <th>Kontakt</th>
                    <th>Odvětví</th>
                    <th>Výkazy</th>
                    <th>Poslední aktivita</th>
                    <th>Akce</th>
                  </tr>
                </thead>
                <tbody>
                  {% for client in clients %}
                  <tr>
                    <td>
                      <strong>{{ client.company_name }}</strong>
                      {% if client.city %}
                        <br><small class="text-muted">📍 {{ client.city }}</small>
                      {% endif %}
                    </td>
                    <td>{{ client.ico|default:"-" }}</td>
                    <td>
                      {{ client.contact_person|default:"-" }}
                      {% if client.phone %}
                        <br><small class="text-muted">📞 {{ client.phone }}</small>
                      {% endif %}
                    </td>
                    <td>{{ client.industry|default:"-" }}</td>
                    <td>
                      <span class="badge bg-{% if client.statements_count > 0 %}success{% else %}secondary{% endif %}">
                        {{ client.statements_count }} výkazů
                      </span>
                    </td>
                    <td>
                      {% if client.last_activity %}
                        {{ client.last_activity|date:"d.m.Y" }}
                      {% else %}
                        <span class="text-muted">Žádná aktivita</span>
                      {% endif %}
                    </td>
                    <td>
                      <div class="btn-group btn-group-sm">
                        <a href="{% url 'coaching:client_dashboard' client.id %}" 
                           class="btn btn-primary" title="Zobrazit dashboard klienta">
                          📊 Dashboard
                        </a>
                        <a href="{% url 'coaching:client_documents' client.id %}" 
                           class="btn btn-outline-secondary" title="Dokumenty klienta">
                          📄 Dokumenty
                        </a>
                        <a href="mailto:{{ client.user.email }}" 
                           class="btn btn-outline-info" title="Napsat email">
                          ✉️
                        </a>
                      </div>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% else %}
            <div class="text-center py-5">
              <h4 class="text-muted">Zatím nemáte přiřazené žádné klienty</h4>
              <p class="text-muted">Klienti budou přiřazeni administrátorem systému.</p>
            </div>
          {% endif %}
        </div>
      </div>

      <!-- Rychlé akce -->
      <div class="row mt-4">
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">
              <h6>🚀 Rychlé akce</h6>
            </div>
            <div class="card-body">
              <div class="d-grid gap-2">
                <a href="{% url 'coaching:clients_overview' %}" class="btn btn-outline-primary">
                  📊 Přehled všech klientů
                </a>
                <a href="{% url 'coaching:coach_reports' %}" class="btn btn-outline-success">
                  📈 Reporty a analýzy
                </a>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">
              <h6>📅 Nedávná aktivita</h6>
            </div>
            <div class="card-body">
              {% if recent_activities %}
                <ul class="list-unstyled">
                  {% for activity in recent_activities %}
                  <li class="mb-2">
                    <small class="text-muted">{{ activity.date|date:"d.m H:i" }}</small><br>
                    <strong>{{ activity.client_name }}</strong>: {{ activity.description }}
                  </li>
                  {% endfor %}
                </ul>
              {% else %}
                <p class="text-muted">Žádná nedávná aktivita</p>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}