{% extends "base.html" %}
{% block content %}
<div>
  <h2>üìö Moje historie dotazn√≠k≈Ø (hodnocen√≠)</h2>

  {% if not batches %}
    <div>Zat√≠m nem√°≈° ≈æ√°dn√© odeslan√© z√°znamy.</div>
  {% else %}
    {% for b in batches %}
      <div style="border: 1px solid #ddd; padding: 1em; margin-bottom: 1.5em;">
        <div style="display: flex; justify-content: space-between; font-size: small; color: gray;">
          <span><b>Batch:</b> {{ b.batch_id }}</span>
          <span>{{ b.created_at|date:"d.m.Y H:i" }}</span>
        </div>

        <!-- üîπ Celkov√© hodnocen√≠ -->
        {% if b.avg_score %}
          <div style="margin-top: 0.5em;">
            <b>Celkov√© hodnocen√≠:</b>
            <span class="badge score-badge" data-score="{{ b.avg_score }}">
              {{ b.avg_score }}
            </span>
          </div>
        {% endif %}

        {% if b.ai_response %}
          <h5>üí° AI shrnut√≠</h5>
          <pre style="white-space:pre-wrap;">{{ b.ai_response }}</pre>
          <hr>
        {% endif %}

        {% for item in b.items %}
          <div style="margin-bottom: 1em;">
            <div><b>{{ item.question }}</b></div>
            <div>{{ item.answer }}</div>
          </div>
        {% endfor %}
      </div>
    {% endfor %}
  {% endif %}
</div>

<!-- üîπ Script na barven√≠ badge -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll(".score-badge").forEach(el => {
    const score = parseFloat(el.dataset.score); // 1‚Äì10
    const ratio = (score - 1) / 9; // normalizace 0‚Äì1
    const hue = 0 + (120 * ratio); // 0 = ƒçerven√°, 120 = zelen√°
    el.style.backgroundColor = `hsl(${hue}, 80%, 40%)`;
    el.style.color = "white";
    el.style.fontWeight = "bold";
    el.style.padding = "0.4em 0.7em";
    el.style.borderRadius = "0.5em";
  });
});
</script>
{% endblock %}
