{% extends "base.html" %}
{% block content %}
<div class="section-shell">
  <section class="scb-panel">
    <div class="page-heading">
      <span class="page-eyebrow">Survey</span>
      <h2 class="page-title">üìö Moje historie dotazn√≠k≈Ø</h2>
      <p class="page-subtitle">
        P≈ôehled v≈°ech odeslan√Ωch dotazn√≠k≈Ø vƒçetnƒõ celkov√©ho sk√≥re, AI shrnut√≠ a jednotliv√Ωch odpovƒõd√≠.
      </p>
    </div>

    {% if not batches %}
    <div class="alert alert-secondary mt-3 mb-0">
      Zat√≠m nem√°≈° ≈æ√°dn√© odeslan√© z√°znamy.
    </div>
    {% else %}
    <div class="survey-history-list mt-4">
      {% for b in batches %}
      <div class="survey-history-card">
        <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 small text-muted">
          <span><strong>Batch:</strong> {{ b.batch_id }}</span>
          <span>{{ b.created_at|date:"d.m.Y H:i" }}</span>
        </div>

        {% if b.avg_score %}
        <div class="mt-3">
          <span class="filter-title d-block mb-1 text-uppercase">Celkov√© hodnocen√≠</span>
          <span class="badge score-badge" data-score="{{ b.avg_score }}">{{ b.avg_score }}</span>
        </div>
        {% endif %}

        {% if b.ai_response %}
        <div class="mt-3">
          <h5>üí° AI shrnut√≠</h5>
          <p class="panel-subtitle" style="white-space: pre-wrap;">{{ b.ai_response }}</p>
        </div>
        {% endif %}

        <div class="mt-3">
          {% for item in b.items %}
          <div class="mb-3">
            <strong>{{ item.question }}</strong>
            <p class="panel-subtitle mb-0">{{ item.answer }}</p>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endfor %}
    </div>
    {% endif %}
  </section>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll(".score-badge").forEach(el => {
    const score = parseFloat(el.dataset.score);
    const ratio = (score - 1) / 9;
    const hue = 0 + (120 * ratio);
    el.style.backgroundColor = `hsl(${hue}, 80%, 40%)`;
    el.style.color = "white";
    el.style.fontWeight = "bold";
    el.style.padding = "0.45rem 0.85rem";
    el.style.borderRadius = "999px";
  });
});
</script>
{% endblock %}
