{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h2>üìù Nov√Ω dotazn√≠k</h2>

  <!-- Formul√°≈ô dotazn√≠ku -->
<form method="post">
  {% csrf_token %}
  {% for q in questions %}
    <div class="card p-3 mb-4 shadow-sm">
      <h5><b>{{ q.category }}:</b> {{ q.question }}</h5>

      <!-- Tabulka popisk≈Ø pro hodnoty -->
      <div class="row text-center mt-3 mb-2 small">
        {% for range, label in q.labels.items %}
          <div class="col">
            <b>{{ range }}</b><br>
            <span>{{ label }}</span>
          </div>
        {% endfor %}
      </div>

      <!-- Slider s aktu√°ln√≠ hodnotou -->
      <div class="d-flex align-items-center">
        <input type="range" class="form-range flex-grow-1"
               name="q{{ forloop.counter0 }}"
               min="1" max="10" value="5"
               oninput="this.parentNode.querySelector('output').value = this.value">
        <output class="badge bg-warning text-dark ms-3">5</output>
      </div>
    </div>
  {% endfor %}
  <button type="submit" class="btn btn-success">Odeslat dotazn√≠k</button>
</form>


  <!-- P≈ôehled vyplnƒõn√Ωch dotazn√≠k≈Ø -->
  <div class="card mt-5 p-3">
    <h3>üìä Moje vyplnƒõn√© dotazn√≠ky</h3>
    <table class="table table-striped mt-3">
      <thead>
        <tr>
          <th>Datum</th>
          <th>Celkov√© hodnocen√≠</th>
          <th>Akce</th>
        </tr>
      </thead>
      <tbody>
        {% for s in submissions %}
          <tr>
            <td>{{ s.created_at|date:"d.m.Y H:i" }}</td>
            <td>
              {% if s.avg_score %}
                <span class="badge score-badge" data-score="{{ s.avg_score }}">
                  {{ s.avg_score }}
                </span>
              {% else %}
                -
              {% endif %}
            </td>
            <td>
              <a href="{% url 'survey:detail' s.batch_id %}" class="btn btn-sm btn-primary">
                Zobrazit detail s grafem
              </a>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="3" class="text-muted">Zat√≠m nem√°≈° ≈æ√°dn√© z√°znamy.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Barevn√© zv√Ωraznƒõn√≠ sk√≥re -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll(".score-badge").forEach(el => {
    const score = parseFloat(el.dataset.score);
    if (isNaN(score)) return;
    const ratio = (score - 1) / 9; // 0‚Äì1
    const hue = 0 + (120 * ratio); // 0=ƒçerven√° ‚Üí 120=zelen√°
    el.style.backgroundColor = `hsl(${hue}, 80%, 40%)`;
    el.style.color = "white";
    el.style.fontWeight = "bold";
    el.style.padding = "6px 10px";
    el.style.borderRadius = "8px";
  });
});
</script>
{% endblock %}
