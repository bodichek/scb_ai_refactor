{% extends "base.html" %}{% block content %}
<div class="section-shell">
  <section class="scb-panel scb-panel--inline">
    <div class="page-heading">
      <span class="page-eyebrow">Survey</span>
      <h2 class="page-title">üìù Nov√Ω dotazn√≠k</h2>
      <p class="page-subtitle">
        Zhodno≈•te aktu√°ln√≠ stav firmy v jednotliv√Ωch oblastech. V√Ωsledky okam≈æitƒõ porovn√°me s p≈ôedchoz√≠mi odpovƒõƒèmi.
      </p>
    </div>

    <form method="post" class="mt-3">
      {% csrf_token %}
      <div class="survey-history-list">
        {% for q in questions %}
        <div class="card scb-question-card p-4">
          <h5 class="mb-0"><b>{{ q.category }}:</b> {{ q.question }}</h5>

          <div class="row text-center mt-3 mb-2 small">
            {% for range, label in q.labels.items %}
            <div class="col py-2">
              <b>{{ range }}</b><br>
              <span>{{ label }}</span>
            </div>
            {% endfor %}
          </div>

          <div class="d-flex align-items-center">
            <input type="range" class="form-range flex-grow-1"
                   name="q{{ forloop.counter0 }}"
                   min="1" max="10" value="5"
                   oninput="this.parentNode.querySelector('output').value = this.value">
            <output class="badge bg-warning text-dark ms-3">5</output>
          </div>
        </div>
        {% endfor %}
      </div>
      <div class="mt-4">
        <button type="submit" class="btn btn-success btn-lg px-4">Odeslat dotazn√≠k</button>
      </div>
    </form>
  </section>

  <section class="scb-panel mt-2">
    <div class="scb-panel-header">
      <h3>üìä Moje vyplnƒõn√© dotazn√≠ky</h3>
      <p class="panel-subtitle">Porovnejte trend hodnocen√≠ a otev≈ôete detaily s AI koment√°≈ôem.</p>
    </div>
    <div class="scb-table-scroll mt-3">
      <table class="table scb-data-table align-middle">
        <thead>
          <tr>
            <th>Datum</th>
            <th>Celkov√© hodnocen√≠</th>
            <th>Akce</th>
          </tr>
        </thead>
        <tbody>
          {% for s in submissions %}
          <tr>
            <td>{{ s.created_at|date:"d.m.Y H:i" }}</td>
            <td>
              {% if s.avg_score %}
              <span class="badge score-badge" data-score="{{ s.avg_score }}">
                {{ s.avg_score }}
              </span>
              {% else %}
              -
              {% endif %}
            </td>
            <td>
              <a href="{% url 'survey:detail' s.batch_id %}" class="btn btn-sm btn-primary">
                Zobrazit detail s grafem
              </a>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="3" class="text-muted">Zat√≠m nem√°≈° ≈æ√°dn√© z√°znamy.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll(".score-badge").forEach(el => {
    const score = parseFloat(el.dataset.score);
    if (isNaN(score)) return;
    const ratio = (score - 1) / 9;
    const hue = 0 + (120 * ratio);
    el.style.backgroundColor = `hsl(${hue}, 80%, 40%)`;
    el.style.color = "white";
    el.style.fontWeight = "bold";
    el.style.padding = "6px 10px";
    el.style.borderRadius = "8px";
  });
});
</script>
{% endblock %}
