{% extends "base.html" %}
{% block content %}
<div class="container">
  <h2>ğŸ“‹ Detail dotaznÃ­ku</h2>
  <p><b>VyplnÄ›no:</b> {{ submission.created_at|date:"d.m.Y H:i" }}</p>

  <!-- Seznam odpovÄ›dÃ­ -->
  <ul class="list-group mb-3">
    {% for r in responses %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <span>{{ r.question }}</span>
        <!-- ğŸ”¹ BarevnÃ½ badge podle skÃ³re -->
        <span class="badge score-badge" data-score="{{ r.score }}">{{ r.label }}</span>
      </li>
    {% endfor %}
  </ul>

  <!-- PrÅ¯mÄ›r -->
  <div class="alert alert-info">
    <b>PrÅ¯mÄ›rnÃ© skÃ³re:</b> {{ avg_score|floatformat:1 }}
  </div>

  <!-- ğŸ”¹ Graf vÃ½voje prÅ¯mÄ›rnÃ©ho skÃ³re -->
  <div class="mt-5">
    <h3>ğŸ“ˆ VÃ½voj prÅ¯mÄ›rnÃ©ho skÃ³re v Äase</h3>
    <canvas id="historyChart"></canvas>
  </div>

  <a href="{% url 'survey:summary' %}" class="btn btn-secondary mt-4">â† ZpÄ›t na pÅ™ehled</a>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('historyChart').getContext('2d');
  const historyChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: {{ chart_labels|safe }},
      datasets: [{
        label: 'PrÅ¯mÄ›rnÃ© skÃ³re',
        data: {{ chart_data|safe }},
        borderColor: 'blue',
        backgroundColor: 'rgba(0,123,255,0.2)',
        fill: true,
        tension: 0.2,
        pointRadius: 5,
        pointHoverRadius: 7
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false }
      },
      scales: {
        y: {
          min: 1,
          max: 10,
          ticks: { stepSize: 1 }
        }
      }
    }
  });
</script>

<!-- ğŸ”¹ BarvenÃ­ odpovÄ›dÃ­ podle skÃ³re -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll(".score-badge").forEach(el => {
    const score = parseFloat(el.dataset.score); // hodnota 1â€“10
    const ratio = (score - 1) / 9; // pÅ™evod na 0â€“1
    const hue = 0 + (120 * ratio); // 0 = ÄervenÃ¡, 120 = zelenÃ¡

    el.style.backgroundColor = `hsl(${hue}, 80%, 40%)`;
    el.style.color = "white";
    el.style.fontWeight = "bold";
    el.style.padding = "6px 10px";
    el.style.borderRadius = "8px";
    el.style.minWidth = "250px";
    el.style.textAlign = "center";
    el.style.whiteSpace = "normal";
  });
});
</script>
{% endblock %}
