{% extends "base.html" %}

{% block content %}
<div class="section-shell">
  <section class="scb-panel">
    <div class="scb-panel-header">
      <div>
        <span class="page-eyebrow">Intercom</span>
        <h2 class="page-title">{{ thread.client }} ↔ {{ thread.coach }}</h2>
      </div>
    </div>

    <div class="mt-3 border border-slate-200 dark:border-slate-700 rounded-3xl bg-white/95 dark:bg-slate-900/60 p-4">
      <form hx-post="{% url 'intercom:mark_read' %}" hx-trigger="load" hx-swap="none" method="post">{% csrf_token %}</form>
      <div id="messages" class="space-y-3 max-h-[60vh] overflow-y-auto">
        {% for m in messages %}
          {% include "intercom/_message_item.html" with m=m %}
        {% empty %}
          <div class="text-sm text-slate-500 dark:text-slate-300">Zatím žádné zprávy…</div>
        {% endfor %}
      </div>
    </div>

    <form
      hx-post="{% url 'intercom:send' client_id=thread.client_id %}"
      hx-target="#messages"
      hx-swap="beforeend"
      class="mt-4 d-flex gap-2">
      {% csrf_token %}
      <textarea name="body" rows="2" class="form-control" placeholder="Napiš zprávu…"></textarea>
      <button class="scb-btn scb-btn-primary" type="submit">Odeslat</button>
    </form>
  </section>
</div>
{% endblock %}
