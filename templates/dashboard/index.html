{% extends "base.html" %}
{% block content %}
<div class="section-shell dashboard-page">
  <section class="scb-panel scb-panel--intro">
    <div class="page-heading">
      <span class="page-eyebrow">Finanční přehled</span>
      <h2 class="page-title">📊 Dashboard</h2>
      <p class="page-subtitle">
        Sledujte klíčové metriky firmy, porovnávejte období a mějte růst i ziskovost pod kontrolou v moderním rozhraní.
      </p>
    </div>
    <div class="scb-filter-group">
      <p class="filter-title">Vyber roky</p>
      <div class="scb-chip-set">
        {% for r in table_rows %}
        <label class="scb-chip">
          <input type="checkbox" class="year-filter" value="{{ r.year }}" checked>
          <span>{{ r.year }}</span>
        </label>
        {% endfor %}
      </div>
    </div>
    <div class="dashboard-actions">
      <button type="button" class="scb-btn scb-btn-primary" id="chart-export-trigger">
        📥 Připravit grafy pro export
      </button>
      <span class="dashboard-actions__hint" id="chart-export-status">Ulož grafy a pokračuj na export PDF.</span>
      <a href="{% url 'exports:export_form' %}" class="scb-btn scb-btn-ghost">📝 Otevřít export PDF</a>
    </div>
  </section>

  <section class="scb-panel scb-panel--charts">
    <div class="chart-grid chart-grid--compact">
      <article class="chart-card chart-card--compact">
        <h3>Váš příběh zisku</h3>
        <div class="chart-card__canvas">
          <canvas id="profitStoryChart"></canvas>
        </div>
      </article>

      <article class="chart-card chart-card--compact">
        <h3>Trend ziskovosti</h3>
        <div class="chart-card__canvas">
          <canvas id="profitabilityTrendsChart"></canvas>
        </div>
      </article>

      <article class="chart-card chart-card--compact">
        <h3>Růst tržeb vs. růst nákladů na prodané zboží</h3>
        <div class="chart-card__canvas">
          <canvas id="revCogsGrowthChart"></canvas>
        </div>
      </article>

      <article class="chart-card chart-card--compact">
        <h3>Růst tržeb vs. růst provozních nákladů</h3>
        <div class="chart-card__canvas">
          <canvas id="revOverheadsGrowthChart"></canvas>
        </div>
      </article>
    </div>
  </section>

  <section class="scb-panel scb-panel--table">
    <div class="scb-panel-header">
      <h3>📑 Přehled dat</h3>
      <p class="panel-subtitle">Kompletní tabulka ukazatelů pro rychlou orientaci v jednotlivých rocích.</p>
    </div>
    <div class="scb-table-scroll">
      <table class="table scb-data-table align-middle text-center">
        <thead class="table-light">
          <tr>
            <th>
              Rok
              <span data-bs-toggle="tooltip" title="Rok, ke kterému se vztahují finanční výsledky.">❓</span>
            </th>
            <th>
              Tržby (Kč)
              <span data-bs-toggle="tooltip" title="Celkové výnosy z prodeje zboží nebo služeb (Revenue).">❓</span>
            </th>
            <th>
              Náklady na prodané zboží (Kč)
              <span data-bs-toggle="tooltip" title="Náklady spojené přímo s výrobou nebo nákupem prodaného zboží (COGS).">❓</span>
            </th>
            <th>
              Hrubá marže (Kč)
              <span data-bs-toggle="tooltip" title="Rozdíl mezi tržbami a náklady na prodané zboží (Revenue - COGS).">❓</span>
            </th>
            <th>
              Provozní náklady (Kč)
              <span data-bs-toggle="tooltip" title="Fixní a variabilní náklady na provoz firmy (Overheads).">❓</span>
            </th>
            <th>
              EBIT (Kč)
              <span data-bs-toggle="tooltip" title="Zisk před úroky a zdaněním – ukazatel provozní výkonnosti firmy.">❓</span>
            </th>
            <th>
              Čistý zisk (Kč)
              <span data-bs-toggle="tooltip" title="Zisk po zdanění, finální hospodářský výsledek (Net Profit).">❓</span>
            </th>
            <th>
              Hrubá marže %
              <span data-bs-toggle="tooltip" title="Podíl hrubé marže na tržbách: (Hrubá marže / Tržby) × 100.">❓</span>
            </th>
            <th>
              Provozní marže %
              <span data-bs-toggle="tooltip" title="Podíl EBIT na tržbách: (EBIT / Tržby) × 100.">❓</span>
            </th>
            <th>
              Čistá marže %
              <span data-bs-toggle="tooltip" title="Podíl čistého zisku na tržbách: (Čistý zisk / Tržby) × 100.">❓</span>
            </th>
            <th>
              Růst tržeb %
              <span data-bs-toggle="tooltip" title="Meziroční změna tržeb oproti předchozímu roku.">❓</span>
            </th>
            <th>
              Růst nákladů na prodané zboží %
              <span data-bs-toggle="tooltip" title="Meziroční změna nákladů na prodané zboží.">❓</span>
            </th>
            <th>
              Růst provozních nákladů %
              <span data-bs-toggle="tooltip" title="Meziroční změna provozních nákladů.">❓</span>
            </th>
          </tr>
        </thead>
        <tbody>
          {% for r in table_rows %}
          <tr>
            <td>{{ r.year }}</td>
            <td>{{ r.revenue }}</td>
            <td>{{ r.cogs }}</td>
            <td>{{ r.gross_margin }}</td>
            <td>{{ r.overheads }}</td>
            <td>{{ r.ebit }}</td>
            <td>{{ r.net_profit }}</td>
            <td>{{ r.profitability.gm_pct|floatformat:2 }}%</td>
            <td>{{ r.profitability.op_pct|floatformat:2 }}%</td>
            <td>{{ r.profitability.np_pct|floatformat:2 }}%</td>
            <td>{{ r.growth.revenue|floatformat:2 }}%</td>
            <td>{{ r.growth.cogs|floatformat:2 }}%</td>
            <td>{{ r.growth.overheads|floatformat:2 }}%</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

  <section class="scb-panel scb-panel--charts">
    <div class="chart-card">
      <h3>📈 Meziroční přehled</h3>
      <div class="chart-card__canvas">
        <canvas id="allMetricsChart"></canvas>
      </div>
    </div>
  </section>

  <section class="scb-panel scb-panel--inline">
    <div class="scb-panel-header">
      <h3 class="mb-0">
        💰 Zisk vs Peněžní tok
        <span class="scb-metric-bubble" data-bs-toggle="tooltip" title="Porovnání účetního zisku s reálným peněžním tokem - ukazuje rozdíl mezi účetními výsledky a skutečnou hotovostí.">❓</span>
      </h3>
      <div class="scb-filter-group">
        <p class="filter-title mb-1">Vyber rok</p>
        <select id="cashflow-year-select" class="form-select scb-select-inline" onchange="loadCashflowForYear(this.value)">
          {% for r in table_rows %}
          <option value="{{ r.year }}" {% if r.year == selected_year %}selected{% endif %}>{{ r.year }}</option>
          {% endfor %}
        </select>
      </div>
    </div>

    <div id="cashflow-content">
      {% if cashflow %}
      <div class="text-center py-3">
        <div class="spinner-border" role="status">
          <span class="visually-hidden">Načítání...</span>
        </div>
      </div>
      {% else %}
      <div class="alert alert-warning mt-3">
        ⚠️ Analýzu Zisk vs Peněžní tok zatím nebylo možné vypočítat – zkontrolujte, že máte nahrané finanční výkazy pro vybraný rok.
      </div>
      {% endif %}
    </div>
  </section>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
// =======================
// 🌍 Česká lokalizace Chart.js
// =======================
Chart.defaults.locale = 'cs';
Chart.defaults.font.family = 'DejaVu Sans, Arial, Verdana, sans-serif';
Chart.defaults.font.size = 12;
Chart.defaults.font.weight = '500';
Chart.defaults.color = '#041434';
Chart.defaults.plugins.legend.labels.usePointStyle = true;
Chart.defaults.plugins.legend.labels.boxWidth = 12;
Chart.defaults.plugins.legend.labels.padding = 12;
Chart.defaults.plugins.legend.align = 'start';
Chart.defaults.plugins.tooltip.cornerRadius = 10;
Chart.defaults.plugins.tooltip.titleFont = { size: 13, weight: '600' };
Chart.defaults.plugins.tooltip.bodyFont = { size: 12 };
Chart.defaults.plugins.tooltip.boxPadding = 6;

// Aktivace tooltipů (Bootstrap)
document.addEventListener("DOMContentLoaded", function() {
  var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
  tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl);
  });
  
  // Automaticky načteme cashflow pro vybraný rok při načtení stránky
  const yearSelect = document.getElementById('cashflow-year-select');
  if (yearSelect && yearSelect.value) {
    loadCashflowForYear(yearSelect.value);
  }
});

// ===== CASHFLOW FUNCTIONS =====
async function loadCashflowForYear(year) {
  try {
    const response = await fetch(`/dashboard/api/cashflow/${year}/`);
    if (response.ok) {
      const html = await response.text();
      document.getElementById('cashflow-content').innerHTML = html;
      
      // Znovu aktivujeme tooltips pro nový obsah
      const tooltipTriggerList = document.querySelectorAll('#cashflow-content [data-bs-toggle="tooltip"]');
      [...tooltipTriggerList].map(el => new bootstrap.Tooltip(el));
    } else {
      document.getElementById('cashflow-content').innerHTML = 
        '<div class="alert alert-danger">⚠️ Nepodařilo se načíst cashflow data pro rok ' + year + '</div>';
    }
  } catch (error) {
    console.error('Chyba při načítání cashflow:', error);
    document.getElementById('cashflow-content').innerHTML = 
      '<div class="alert alert-danger">⚠️ Chyba při načítání cashflow dat</div>';
  }
}

// ===== DATA =====
const rows = {{ rows|safe }};
const years = {{ years|safe }};

function getSelectedYears() {
  return Array.from(document.querySelectorAll(".year-filter:checked")).map(cb => parseInt(cb.value));
}
function filterRowsByYears(selectedYears) {
  return rows.filter(r => selectedYears.includes(r.year));
}

let profitStoryChart, profitabilityTrendsChart, revCogsGrowthChart, revOverheadsGrowthChart, allMetricsChart;

function renderCharts() {
  const selectedYears = getSelectedYears();
  const dataRows = filterRowsByYears(selectedYears);
  const labels = dataRows.map(r => r.year);

  // ========================
  // 📈 Váš příběh zisku
  // ========================
  const categories = ["Tržby", "Náklady na prodané zboží", "Hrubá marže", "Provozní náklady", "EBIT", "Čistý zisk"];
  const datasets = dataRows.map((row, idx) => ({
    label: row.year,
    data: [row.revenue, row.cogs, row.gross_margin, row.overheads, row.ebit, row.net_profit],
    backgroundColor: `hsl(${(idx * 70) % 360},70%,54%)`,
    borderRadius: 12,
    maxBarThickness: 40
  }));
  if (profitStoryChart) profitStoryChart.destroy();
  profitStoryChart = new Chart(document.getElementById("profitStoryChart"), {
    type: "bar",
    data: { labels: categories, datasets },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      layout: { padding: { top: 12, right: 18, bottom: 16, left: 16 } },
      plugins: {
        title: { display: false },
        tooltip: {
          callbacks: {
            label: (item) => `${item.label}: ${item.formattedValue.toLocaleString('cs-CZ')} Kč`
          },
          displayColors: true,
          backgroundColor: 'rgba(4, 20, 52, 0.92)'
        },
        legend: {
          position: "top",
          labels: { color: 'rgba(4,20,52,0.85)' }
        }
      },
      scales: {
        y: {
          title: {
            display: true,
            text: "Hodnota (Kč)",
            color: 'rgba(4,20,52,0.8)',
            font: { size: 12, weight: '600' }
          },
          ticks: {
            callback: (v) => v.toLocaleString('cs-CZ'),
            color: 'rgba(4,20,52,0.65)',
            font: { size: 11 }
          },
          grid: { color: 'rgba(4, 20, 52, 0.08)', drawBorder: false }
        },
        x: {
          ticks: {
            color: 'rgba(4,20,52,0.7)',
            font: { size: 11 }
          },
          grid: { display: false }
        }
      }
    }
  });

  // ========================
  // 📊 Trend ziskovosti
  // ========================
  const datasetsTrends = dataRows.map((row, idx) => ({
    label: row.year,
    data: [row.profitability.gm_pct, row.profitability.op_pct, row.profitability.np_pct],
    backgroundColor: `hsl(${(idx * 70) % 360},70%,54%)`,
    borderRadius: 12,
    maxBarThickness: 40
  }));
  if (profitabilityTrendsChart) profitabilityTrendsChart.destroy();
  profitabilityTrendsChart = new Chart(document.getElementById("profitabilityTrendsChart"), {
    type: "bar",
    data: { labels: ["Hrubá marže %", "Provozní marže %", "Čistá marže %"], datasets: datasetsTrends },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      layout: { padding: { top: 12, right: 18, bottom: 16, left: 16 } },
      plugins: {
        title: { display: false },
        tooltip: {
          callbacks: {
            label: (item) => `${item.label}: ${item.formattedValue}%`
          },
          backgroundColor: 'rgba(4, 20, 52, 0.92)'
        },
        legend: {
          position: "top",
          labels: { color: 'rgba(4,20,52,0.85)' }
        }
      },
      scales: {
        y: {
          ticks: {
            callback: (v) => v + "%",
            color: 'rgba(4,20,52,0.65)',
            font: { size: 11 }
          },
          grid: { color: 'rgba(4, 20, 52, 0.08)', drawBorder: false }
        },
        x: {
          ticks: { color: 'rgba(4,20,52,0.7)', font: { size: 11 } },
          grid: { display: false }
        }
      }
    }
  });

  // ========================
  // 📈 Růst tržeb vs. COGS
  // ========================
  const revGrowth = dataRows.map(r => r.growth.revenue);
  const cogsGrowth = dataRows.map(r => r.growth.cogs);
  if (revCogsGrowthChart) revCogsGrowthChart.destroy();
  revCogsGrowthChart = new Chart(document.getElementById("revCogsGrowthChart"), {
    type: "bar",
    data: {
      labels,
      datasets: [
        { label: "Růst tržeb (%)", data: revGrowth, backgroundColor: "rgba(0,123,255,0.75)", borderRadius: 10, maxBarThickness: 42 },
        { label: "Růst nákladů na prodané zboží (%)", data: cogsGrowth, backgroundColor: "rgba(255,99,132,0.75)", borderRadius: 10, maxBarThickness: 42 }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      layout: { padding: { top: 12, right: 18, bottom: 16, left: 16 } },
      plugins: {
        title: { display: false },
        tooltip: {
          callbacks: { label: (item) => `${item.dataset.label}: ${item.formattedValue}%` },
          backgroundColor: 'rgba(4, 20, 52, 0.92)'
        },
        legend: {
          position: "top",
          labels: { color: 'rgba(4,20,52,0.85)' }
        }
      },
      scales: {
        y: {
          ticks: {
            callback: (v) => `${v}%`,
            color: 'rgba(4,20,52,0.65)',
            font: { size: 11 }
          },
          grid: { color: 'rgba(4, 20, 52, 0.08)', drawBorder: false }
        },
        x: {
          ticks: { color: 'rgba(4,20,52,0.7)', font: { size: 11 } },
          grid: { display: false }
        }
      }
    }
  });

  // ========================
  // 📈 Růst tržeb vs. provozní náklady
  // ========================
  const overheadsGrowth = dataRows.map(r => r.growth.overheads);
  if (revOverheadsGrowthChart) revOverheadsGrowthChart.destroy();
  revOverheadsGrowthChart = new Chart(document.getElementById("revOverheadsGrowthChart"), {
    type: "bar",
    data: {
      labels,
      datasets: [
        { label: "Růst tržeb (%)", data: revGrowth, backgroundColor: "rgba(0,123,255,0.75)", borderRadius: 10, maxBarThickness: 42 },
        { label: "Růst provozních nákladů (%)", data: overheadsGrowth, backgroundColor: "rgba(255,206,86,0.75)", borderRadius: 10, maxBarThickness: 42 }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      layout: { padding: { top: 12, right: 18, bottom: 16, left: 16 } },
      plugins: {
        title: { display: false },
        tooltip: {
          callbacks: { label: (item) => `${item.dataset.label}: ${item.formattedValue}%` },
          backgroundColor: 'rgba(4, 20, 52, 0.92)'
        },
        legend: {
          position: "top",
          labels: { color: 'rgba(4,20,52,0.85)' }
        }
      },
      scales: {
        y: {
          ticks: {
            callback: (v) => `${v}%`,
            color: 'rgba(4,20,52,0.65)',
            font: { size: 11 }
          },
          grid: { color: 'rgba(4, 20, 52, 0.08)', drawBorder: false }
        },
        x: {
          ticks: { color: 'rgba(4,20,52,0.7)', font: { size: 11 } },
          grid: { display: false }
        }
      }
    }
  });

  // ========================
  // 📊 Meziroční přehled (All Metrics)
  // ========================
  if (allMetricsChart) allMetricsChart.destroy();
  allMetricsChart = new Chart(document.getElementById("allMetricsChart"), {
    type: "line",
    data: {
      labels,
      datasets: [
        { label: "Tržby", data: dataRows.map(r => r.revenue), borderColor: "#2563eb", backgroundColor: "rgba(37,99,235,0.15)", tension: 0.35, borderWidth: 3, pointRadius: 4, pointHoverRadius: 6, fill: true },
        { label: "COGS (náklady na prodané zboží)", data: dataRows.map(r => r.cogs), borderColor: "#f97316", backgroundColor: "rgba(249,115,22,0.15)", tension: 0.35, borderWidth: 3, pointRadius: 4, pointHoverRadius: 6, fill: true },
        { label: "Hrubá marže", data: dataRows.map(r => r.gross_margin), borderColor: "#10b981", backgroundColor: "rgba(16,185,129,0.15)", tension: 0.35, borderWidth: 3, pointRadius: 4, pointHoverRadius: 6, fill: true },
        { label: "Provozní náklady", data: dataRows.map(r => r.overheads), borderColor: "#facc15", backgroundColor: "rgba(250,204,21,0.18)", tension: 0.35, borderWidth: 3, pointRadius: 4, pointHoverRadius: 6, fill: true },
        { label: "EBIT", data: dataRows.map(r => r.ebit), borderColor: "#a855f7", backgroundColor: "rgba(168,85,247,0.15)", tension: 0.35, borderWidth: 3, pointRadius: 4, pointHoverRadius: 6, fill: true },
        { label: "Čistý zisk", data: dataRows.map(r => r.net_profit), borderColor: "#ef4444", backgroundColor: "rgba(239,68,68,0.15)", tension: 0.35, borderWidth: 3, pointRadius: 4, pointHoverRadius: 6, fill: true }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      layout: { padding: { top: 12, right: 18, bottom: 18, left: 18 } },
      plugins: {
        title: { display: false },
        tooltip: {
          callbacks: { label: (item) => `${item.dataset.label}: ${item.formattedValue.toLocaleString('cs-CZ')} Kč` },
          backgroundColor: 'rgba(4, 20, 52, 0.92)'
        },
        legend: {
          position: "top",
          labels: { color: 'rgba(4,20,52,0.85)' }
        }
      },
      scales: {
        y: {
          ticks: {
            callback: (v) => v.toLocaleString('cs-CZ') + " Kč",
            color: 'rgba(4,20,52,0.65)',
            font: { size: 11 }
          },
          grid: { color: 'rgba(4, 20, 52, 0.08)', drawBorder: false }
        },
        x: {
          ticks: { color: 'rgba(4,20,52,0.7)', font: { size: 11 } },
          grid: { color: 'rgba(4,20,52,0.04)' }
        }
      }
    }
  });
}

document.querySelectorAll(".year-filter").forEach(cb => cb.addEventListener("change", renderCharts));
renderCharts();
</script>
<script>
// ===== EXPORT FUNKCE =====

function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== '') {
    const cookies = document.cookie.split(';');
    for (let i = 0; i < cookies.length; i++) {
      const cookie = cookies[i].trim();
      if (cookie.substring(0, name.length + 1) === (name + '=')) {
        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
        break;
      }
    }
  }
  return cookieValue;
}

// =============================
// 💾 Uložení jednoho grafu
// =============================
async function saveChartAsImage(chart, chartId) {
  if (!chart) {
    console.warn(`⚠️ Graf ${chartId} nebyl nalezen.`);
    return;
  }

  const imgData = chart.toBase64Image();

  if (!imgData || imgData.length < 100) {
    console.error(`❌ Graf ${chartId} je prázdný nebo neplatný.`);
    return;
  }

  try {
    const response = await fetch("/dashboard/save_chart/", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-CSRFToken": getCookie("csrftoken")
      },
      body: JSON.stringify({
        image: imgData,
        chart_id: chartId
      })
    });

    const text = await response.text(); // načteme i v případě chyby
    let data;
    try {
      data = JSON.parse(text);
    } catch {
      console.error("⚠️ Server nevrátil JSON:", text);
      return;
    }

    if (data.status !== "ok") {
      console.error(`❌ Chyba při ukládání grafu ${chartId}:`, data.message);
    } else {
      console.log(`✅ Graf uložen:`, data.file);
    }

    await new Promise(resolve => setTimeout(resolve, 150)); // krátká pauza
  } catch (e) {
    console.error("❌ Fetch error:", e);
  }
}

// =============================
// 💾 Uložení všech grafů
// =============================
async function saveAllCharts() {
  const charts = [
    { chart: profitStoryChart, id: "profit_story" },
    { chart: profitabilityTrendsChart, id: "profitability_trends" },
    { chart: revCogsGrowthChart, id: "rev_cogs_growth" },
    { chart: revOverheadsGrowthChart, id: "rev_overheads_growth" },
    { chart: allMetricsChart, id: "all_metrics" }
  ];

  console.log(`🟡 Nahrávám ${charts.length} grafů…`);
  for (const c of charts) {
    await saveChartAsImage(c.chart, c.id);
  }
  console.log("✅ Všechny grafy odeslány!");
}

// =============================
// 📤 Tlačítko exportu
// =============================
document.addEventListener("DOMContentLoaded", () => {
  const exportBtn = document.getElementById("chart-export-trigger");
  const statusEl = document.getElementById("chart-export-status");

  if (!exportBtn) {
    console.warn("⚠️ Export button pro grafy nebyl nalezen.");
    return;
  }

  const setStatus = (text, tone = "info") => {
    if (!statusEl) return;
    statusEl.textContent = text;
    statusEl.dataset.statusTone = tone;
  };

  exportBtn.addEventListener("click", async () => {
    if (exportBtn.dataset.busy === "1") {
      return;
    }

    exportBtn.dataset.busy = "1";
    const originalLabel = exportBtn.innerHTML;
    exportBtn.innerHTML = "⏳ Ukládám grafy…";
    exportBtn.setAttribute("aria-disabled", "true");
    exportBtn.classList.add("is-busy");
    setStatus("Chvíli strpení, grafy se připravují…", "info");

    try {
      await saveAllCharts();
      exportBtn.innerHTML = "✅ Grafy připraveny";
      setStatus("Grafy byly úspěšně uloženy. Pokračuj na export PDF.", "success");

      setTimeout(() => {
        exportBtn.innerHTML = originalLabel;
        exportBtn.dataset.busy = "0";
        exportBtn.removeAttribute("aria-disabled");
        exportBtn.classList.remove("is-busy");
        window.location.href = "/exports/";
      }, 900);
    } catch (error) {
      console.error("❌ Nepodařilo se uložit grafy:", error);
      exportBtn.innerHTML = "Zkusit znovu";
      exportBtn.dataset.busy = "0";
      exportBtn.removeAttribute("aria-disabled");
      exportBtn.classList.remove("is-busy");
      setStatus("Nepodařilo se uložit grafy. Zkus to ještě jednou, případně obnov stránku.", "error");
    }
  });
});
</script>
{% endblock %}
